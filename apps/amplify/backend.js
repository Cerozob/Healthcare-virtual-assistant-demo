"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.backend = void 0;
const backend_1 = require("@aws-amplify/backend");
const resource_1 = require("./functions/patients/resource");
const resource_2 = require("./functions/medics/resource");
const resource_3 = require("./functions/exams/resource");
const resource_4 = require("./functions/reservations/resource");
const resource_5 = require("./functions/chat/resource");
const resource_6 = require("./functions/agent-integration/resource");
const resource_7 = require("./functions/icd10/resource");
const resource_8 = require("./functions/document-upload/resource");
const resource_9 = require("./storage/resource");
const resource_10 = require("./data/api/resource");
const aws_iam_1 = require("aws-cdk-lib/aws-iam");
exports.backend = (0, backend_1.defineBackend)({
    patientsFunction: resource_1.patientsFunction,
    medicsFunction: resource_2.medicsFunction,
    examsFunction: resource_3.examsFunction,
    reservationsFunction: resource_4.reservationsFunction,
    chatFunction: resource_5.chatFunction,
    agentIntegrationFunction: resource_6.agentIntegrationFunction,
    icd10Function: resource_7.icd10Function,
    documentUploadFunction: resource_8.documentUploadFunction,
    storage: resource_9.storage,
});
// Create the REST API with all endpoints
const api = (0, resource_10.createRestApi)(exports.backend);
// Add SSM permissions to functions that need healthcare configuration access
const ssmPolicy = new aws_iam_1.PolicyStatement({
    actions: [
        'ssm:GetParameter',
        'ssm:GetParameters',
        'ssm:GetParametersByPath'
    ],
    resources: [
        `arn:aws:ssm:${exports.backend.stack.region}:${exports.backend.stack.account}:parameter/healthcare/*`
    ]
});
// Add SSM permissions to all functions that need healthcare configuration
exports.backend.chatFunction.resources.lambda.addToRolePolicy(ssmPolicy);
exports.backend.agentIntegrationFunction.resources.lambda.addToRolePolicy(ssmPolicy);
exports.backend.documentUploadFunction.resources.lambda.addToRolePolicy(ssmPolicy);
exports.backend.medicsFunction.resources.lambda.addToRolePolicy(ssmPolicy);
exports.backend.patientsFunction.resources.lambda.addToRolePolicy(ssmPolicy);
exports.backend.examsFunction.resources.lambda.addToRolePolicy(ssmPolicy);
exports.backend.reservationsFunction.resources.lambda.addToRolePolicy(ssmPolicy);
exports.backend.icd10Function.resources.lambda.addToRolePolicy(ssmPolicy);
// Add the API to backend outputs
exports.backend.addOutput({
    custom: {
        API: {
            [api.restApiName]: {
                endpoint: api.url,
                region: exports.backend.stack.region,
                apiName: api.restApiName,
            },
        },
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFja2VuZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImJhY2tlbmQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQUEsa0RBQXFEO0FBQ3JELDREQUFpRTtBQUNqRSwwREFBNkQ7QUFDN0QseURBQTJEO0FBQzNELGdFQUF5RTtBQUN6RSx3REFBeUQ7QUFDekQscUVBQWtGO0FBQ2xGLHlEQUEyRDtBQUMzRCxtRUFBOEU7QUFDOUUsaURBQTZDO0FBQzdDLG1EQUFvRDtBQUNwRCxpREFBc0Q7QUFFekMsUUFBQSxPQUFPLEdBQUcsSUFBQSx1QkFBYSxFQUFDO0lBQ25DLGdCQUFnQixFQUFoQiwyQkFBZ0I7SUFDaEIsY0FBYyxFQUFkLHlCQUFjO0lBQ2QsYUFBYSxFQUFiLHdCQUFhO0lBQ2Isb0JBQW9CLEVBQXBCLCtCQUFvQjtJQUNwQixZQUFZLEVBQVosdUJBQVk7SUFDWix3QkFBd0IsRUFBeEIsbUNBQXdCO0lBQ3hCLGFBQWEsRUFBYix3QkFBYTtJQUNiLHNCQUFzQixFQUF0QixpQ0FBc0I7SUFDdEIsT0FBTyxFQUFQLGtCQUFPO0NBQ1IsQ0FBQyxDQUFDO0FBRUgseUNBQXlDO0FBQ3pDLE1BQU0sR0FBRyxHQUFHLElBQUEseUJBQWEsRUFBQyxlQUFPLENBQUMsQ0FBQztBQUVuQyw2RUFBNkU7QUFDN0UsTUFBTSxTQUFTLEdBQUcsSUFBSSx5QkFBZSxDQUFDO0lBQ3BDLE9BQU8sRUFBRTtRQUNQLGtCQUFrQjtRQUNsQixtQkFBbUI7UUFDbkIseUJBQXlCO0tBQzFCO0lBQ0QsU0FBUyxFQUFFO1FBQ1QsZUFBZSxlQUFPLENBQUMsS0FBSyxDQUFDLE1BQU0sSUFBSSxlQUFPLENBQUMsS0FBSyxDQUFDLE9BQU8seUJBQXlCO0tBQ3RGO0NBQ0YsQ0FBQyxDQUFDO0FBRUgsMEVBQTBFO0FBQzFFLGVBQU8sQ0FBQyxZQUFZLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxlQUFlLENBQUMsU0FBUyxDQUFDLENBQUM7QUFDakUsZUFBTyxDQUFDLHdCQUF3QixDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsZUFBZSxDQUFDLFNBQVMsQ0FBQyxDQUFDO0FBQzdFLGVBQU8sQ0FBQyxzQkFBc0IsQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLGVBQWUsQ0FBQyxTQUFTLENBQUMsQ0FBQztBQUMzRSxlQUFPLENBQUMsY0FBYyxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsZUFBZSxDQUFDLFNBQVMsQ0FBQyxDQUFDO0FBQ25FLGVBQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLGVBQWUsQ0FBQyxTQUFTLENBQUMsQ0FBQztBQUNyRSxlQUFPLENBQUMsYUFBYSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsZUFBZSxDQUFDLFNBQVMsQ0FBQyxDQUFDO0FBQ2xFLGVBQU8sQ0FBQyxvQkFBb0IsQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLGVBQWUsQ0FBQyxTQUFTLENBQUMsQ0FBQztBQUN6RSxlQUFPLENBQUMsYUFBYSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsZUFBZSxDQUFDLFNBQVMsQ0FBQyxDQUFDO0FBRWxFLGlDQUFpQztBQUNqQyxlQUFPLENBQUMsU0FBUyxDQUFDO0lBQ2hCLE1BQU0sRUFBRTtRQUNOLEdBQUcsRUFBRTtZQUNILENBQUMsR0FBRyxDQUFDLFdBQVcsQ0FBQyxFQUFFO2dCQUNqQixRQUFRLEVBQUUsR0FBRyxDQUFDLEdBQUc7Z0JBQ2pCLE1BQU0sRUFBRSxlQUFPLENBQUMsS0FBSyxDQUFDLE1BQU07Z0JBQzVCLE9BQU8sRUFBRSxHQUFHLENBQUMsV0FBVzthQUN6QjtTQUNGO0tBQ0Y7Q0FDRixDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBkZWZpbmVCYWNrZW5kIH0gZnJvbSAnQGF3cy1hbXBsaWZ5L2JhY2tlbmQnO1xuaW1wb3J0IHsgcGF0aWVudHNGdW5jdGlvbiB9IGZyb20gJy4vZnVuY3Rpb25zL3BhdGllbnRzL3Jlc291cmNlJztcbmltcG9ydCB7IG1lZGljc0Z1bmN0aW9uIH0gZnJvbSAnLi9mdW5jdGlvbnMvbWVkaWNzL3Jlc291cmNlJztcbmltcG9ydCB7IGV4YW1zRnVuY3Rpb24gfSBmcm9tICcuL2Z1bmN0aW9ucy9leGFtcy9yZXNvdXJjZSc7XG5pbXBvcnQgeyByZXNlcnZhdGlvbnNGdW5jdGlvbiB9IGZyb20gJy4vZnVuY3Rpb25zL3Jlc2VydmF0aW9ucy9yZXNvdXJjZSc7XG5pbXBvcnQgeyBjaGF0RnVuY3Rpb24gfSBmcm9tICcuL2Z1bmN0aW9ucy9jaGF0L3Jlc291cmNlJztcbmltcG9ydCB7IGFnZW50SW50ZWdyYXRpb25GdW5jdGlvbiB9IGZyb20gJy4vZnVuY3Rpb25zL2FnZW50LWludGVncmF0aW9uL3Jlc291cmNlJztcbmltcG9ydCB7IGljZDEwRnVuY3Rpb24gfSBmcm9tICcuL2Z1bmN0aW9ucy9pY2QxMC9yZXNvdXJjZSc7XG5pbXBvcnQgeyBkb2N1bWVudFVwbG9hZEZ1bmN0aW9uIH0gZnJvbSAnLi9mdW5jdGlvbnMvZG9jdW1lbnQtdXBsb2FkL3Jlc291cmNlJztcbmltcG9ydCB7IHN0b3JhZ2UgfSBmcm9tICcuL3N0b3JhZ2UvcmVzb3VyY2UnO1xuaW1wb3J0IHsgY3JlYXRlUmVzdEFwaSB9IGZyb20gJy4vZGF0YS9hcGkvcmVzb3VyY2UnO1xuaW1wb3J0IHsgUG9saWN5U3RhdGVtZW50IH0gZnJvbSAnYXdzLWNkay1saWIvYXdzLWlhbSc7XG5cbmV4cG9ydCBjb25zdCBiYWNrZW5kID0gZGVmaW5lQmFja2VuZCh7XG4gIHBhdGllbnRzRnVuY3Rpb24sXG4gIG1lZGljc0Z1bmN0aW9uLFxuICBleGFtc0Z1bmN0aW9uLFxuICByZXNlcnZhdGlvbnNGdW5jdGlvbixcbiAgY2hhdEZ1bmN0aW9uLFxuICBhZ2VudEludGVncmF0aW9uRnVuY3Rpb24sXG4gIGljZDEwRnVuY3Rpb24sXG4gIGRvY3VtZW50VXBsb2FkRnVuY3Rpb24sXG4gIHN0b3JhZ2UsXG59KTtcblxuLy8gQ3JlYXRlIHRoZSBSRVNUIEFQSSB3aXRoIGFsbCBlbmRwb2ludHNcbmNvbnN0IGFwaSA9IGNyZWF0ZVJlc3RBcGkoYmFja2VuZCk7XG5cbi8vIEFkZCBTU00gcGVybWlzc2lvbnMgdG8gZnVuY3Rpb25zIHRoYXQgbmVlZCBoZWFsdGhjYXJlIGNvbmZpZ3VyYXRpb24gYWNjZXNzXG5jb25zdCBzc21Qb2xpY3kgPSBuZXcgUG9saWN5U3RhdGVtZW50KHtcbiAgYWN0aW9uczogW1xuICAgICdzc206R2V0UGFyYW1ldGVyJyxcbiAgICAnc3NtOkdldFBhcmFtZXRlcnMnLFxuICAgICdzc206R2V0UGFyYW1ldGVyc0J5UGF0aCdcbiAgXSxcbiAgcmVzb3VyY2VzOiBbXG4gICAgYGFybjphd3M6c3NtOiR7YmFja2VuZC5zdGFjay5yZWdpb259OiR7YmFja2VuZC5zdGFjay5hY2NvdW50fTpwYXJhbWV0ZXIvaGVhbHRoY2FyZS8qYFxuICBdXG59KTtcblxuLy8gQWRkIFNTTSBwZXJtaXNzaW9ucyB0byBhbGwgZnVuY3Rpb25zIHRoYXQgbmVlZCBoZWFsdGhjYXJlIGNvbmZpZ3VyYXRpb25cbmJhY2tlbmQuY2hhdEZ1bmN0aW9uLnJlc291cmNlcy5sYW1iZGEuYWRkVG9Sb2xlUG9saWN5KHNzbVBvbGljeSk7XG5iYWNrZW5kLmFnZW50SW50ZWdyYXRpb25GdW5jdGlvbi5yZXNvdXJjZXMubGFtYmRhLmFkZFRvUm9sZVBvbGljeShzc21Qb2xpY3kpO1xuYmFja2VuZC5kb2N1bWVudFVwbG9hZEZ1bmN0aW9uLnJlc291cmNlcy5sYW1iZGEuYWRkVG9Sb2xlUG9saWN5KHNzbVBvbGljeSk7XG5iYWNrZW5kLm1lZGljc0Z1bmN0aW9uLnJlc291cmNlcy5sYW1iZGEuYWRkVG9Sb2xlUG9saWN5KHNzbVBvbGljeSk7XG5iYWNrZW5kLnBhdGllbnRzRnVuY3Rpb24ucmVzb3VyY2VzLmxhbWJkYS5hZGRUb1JvbGVQb2xpY3koc3NtUG9saWN5KTtcbmJhY2tlbmQuZXhhbXNGdW5jdGlvbi5yZXNvdXJjZXMubGFtYmRhLmFkZFRvUm9sZVBvbGljeShzc21Qb2xpY3kpO1xuYmFja2VuZC5yZXNlcnZhdGlvbnNGdW5jdGlvbi5yZXNvdXJjZXMubGFtYmRhLmFkZFRvUm9sZVBvbGljeShzc21Qb2xpY3kpO1xuYmFja2VuZC5pY2QxMEZ1bmN0aW9uLnJlc291cmNlcy5sYW1iZGEuYWRkVG9Sb2xlUG9saWN5KHNzbVBvbGljeSk7XG5cbi8vIEFkZCB0aGUgQVBJIHRvIGJhY2tlbmQgb3V0cHV0c1xuYmFja2VuZC5hZGRPdXRwdXQoe1xuICBjdXN0b206IHtcbiAgICBBUEk6IHtcbiAgICAgIFthcGkucmVzdEFwaU5hbWVdOiB7XG4gICAgICAgIGVuZHBvaW50OiBhcGkudXJsLFxuICAgICAgICByZWdpb246IGJhY2tlbmQuc3RhY2sucmVnaW9uLFxuICAgICAgICBhcGlOYW1lOiBhcGkucmVzdEFwaU5hbWUsXG4gICAgICB9LFxuICAgIH0sXG4gIH0sXG59KTtcbiJdfQ==